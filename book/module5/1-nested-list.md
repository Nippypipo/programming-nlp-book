# ลิสต์ที่มีเก็บโครงสร้างข้อมูลอื่นอยู่

## ลิสต์ของลิสต์
ในการใช้งานจริงเราใช้ลิสต์ของลิสต์เพื่อเก็บข้อมูลประเภทเดี่ยวทั้ง 3 ประเภท ลิสต์ของลิสต์ของตัวเลข (ลิสต์ที่มีลิสต์ย่อยที่เก็บตัวเลข) ลิสต์ของลิสต์ของสตริง ลิสต์ของลิสต์ของบูลีน 

ขอยกตัวอย่างการใช้ลิสต์ของลิสต์ของตัวเลข ซึ่งเป็นลิสต์ของคะแนนของนักเรียน โดยแต่ละคะแนนจะประกอบไปด้วย คะแนนเก็บ คะแนนสอบกลางภาค และคะแนนสอบปลายภาค โดยเราจะเก็บคะแนนของนักเรียนแต่ละคนไว้ในลิสต์ของลิสต์ของตัวเลข ดังนี้
```python
scores = [
    [10, 20, 30],
    [40, 50, 60],
    [70, 80, 90]
]
```
เราสามารถเข้าถึงคะแนนของนักเรียนคนที่ 2 ได้ดังนี้
```python
scores[1]
```
ผลลัพธ์ที่ได้คือ
```python
[40, 50, 60]
```
ซึ่งเป็นลิสต์ของคะแนนของนักเรียนคนที่ 2

ลิสต์ของลิสต์มักจะใช้เก็บประโยคหลาย ๆ ประโยค เราจะเก็บประโยค 1 ประโยคไว้ในลิสต์ของสตริงคำ เมื่อเราต้องเก็บหลาย ๆ ประโยคจึงกลายมาเป็นลิสต์ของลิสต์ของสตริงคำ 
```python
[['I', 'want', 'you'], ['I', 'need', 'you'], ['I', 'love', 'you']]
```
ถ้าหากเรามีข้อมูลเป็นลิสต์ของสตริงที่เป็นประโยคภาษาอังกฤษ เราสามารถเปลี่ยนให้เป็นลิสต์ของลิสต์ของคำได้ดังนี้ 
```python
sentences = [
    'I want you',
    'I need you',
    'I love you'
]
words = [sentence.split() for sentence in sentences]
```

ในคำสั่งที่ใช้ list comprehension ในตัวอย่างโค้ดข้างต้น `sentence`  เป็นสตริง เราจึงสามารถใช้ `.split` ในการเปลี่ยนให้สตริง เป็นลิสต์ของคำโดยใช้ช่องว่างเป็นตัวแยก ผลลัพธ์ที่ได้คือ 
```python
[['I', 'want', 'you'], ['I', 'need', 'you'], ['I', 'love', 'you']]
```
ซึ่งเป็นลิสต์ของลิสต์ของสตริง

### คำถามชวนคิด
สมมติว่าเรามีข้อมูลต่อไปนี้
```python
list_sen = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
list_lang = [['th','th','en','th'],['en', 'th', 'th','th', 'th', 'en']]
list_lang2 = [[False, False, True, False], [True, False, False, False, False, True]]
list_len = [[3, 4, 2, 4], [7, 3, 3, 3, 4, 6]]
```
คำสั่งต่อไปนี้คืนค่าเป็นอะไร ซึ่งจัดเป็นข้อมูลประเภทใด
1. `list_sen[0]`
2. `list_lang[1][0]`
3. `list_lang2[1][2]`
4. `list_len[0][3]`

*เฉลย*
| คำสั่ง | คืนค่า | ประเภทข้อมูล | คำอธิบาย |
|:--------|:--------|:---------------|:---------|
| `list_sen[0]` | `['แซม','ซื้อ','tv','ใหม่']` | ลิสต์ของสตริง | `[0]`เข้าถึงข้อมูลในลิสต์ของลิสต์ของสตริง (`list_sen`) จึงแกะลิสต์ออกหนึ่งชั้น ได้~~ลิสต์ของ~~ลิสต์ของสตริง |
| `list_lang[1][0]` | `'en'` | สตริง | `[1]`เข้าถึงข้อมูลในลิสต์ของลิสต์ของสตริง (`list_lang`)จึงแกะลิสต์ออกหนึ่งชั้น ได้~~ลิสต์ของ~~ลิสต์ของสตริง จากนั้น `[0]` เข้าถึงสตริงในลิสต์ของสตริง ได้สตริง |
| `list_lang2[1][2]` | `False` | บูลีน | `[1]`เข้าถึงข้อมูลในลิสต์ของลิสต์ของบูลีน (`list_lang2`) จึงแกะลิสต์ออกหนึ่งชั้น ได้~~ลิสต์ของ~~ลิสต์ของบูลีน จากนั้น `[2]` เข้าถึงบูลีนในลิสต์ของบูลีน ได้บูลีน |
| `list_len[0][3]` | `4` | จำนวนเต็ม | `[0]`เข้าถึงข้อมูลในลิสต์ของลิสต์ของจำนวนเต็ม (`list_len`) จึงแกะลิสต์ออกหนึ่งชั้น ได้~~ลิสต์ของ~~ลิสต์ของจำนวนเต็ม จากนั้น `[3]` เข้าถึงจำนวนเต็มในลิสต์ของจำนวนเต็ม ได้จำนวนเต็ม |

รูปแบบการใช้งานที่พบเห็นบ่อย ๆ ในการประมวลผลข้อมูล ได้แก่

- Iterate ไปบนสมาชิกทุกตัวที่อยู่ในลิสต์ย่อย
- รันฟังก์ชันไปบนสมาชิกทุกตัวที่อยู่ในลิสต์ย่อย
- การทำลิสต์ให้เรียบ (flatten) 

### Iterate ไปบนสมาชิกทุกตัวที่อยู่ในลิสต์ย่อย
สมมติว่าเราต้องให้นับจำนวนคำในประโยคที่เก็บไว้ในลิสต์ของลิสต์ของสตริง เราต้องใช้ for loop เพื่อไล่ลิสต์ย่อยออกมาทีละตัว และแต่ในลิสต์ย่อยเราต้องใช้ for loop อีกชั้นหนึ่งเพื่อไล่สตริงออกมาทีละคำ แปลออกมาเป็น pseudocode ได้ดังนี้
```python
for ลิสต์ย่อย in ลิสต์ใหญ่
    for ข้อมูลเดี่ยว in ลิสต์ย่อย
        ทำอะไรกับข้อมูลเดี่ยว
```

#### ตัวอย่าง
```python
sentences = [['I', 'want', 'you'], ['I', 'need', 'you'], ['I', 'love', 'you']]
total_words = 0
for sentence in sentences:
    for word in sentence:
        total_words += 1
print(total_words)
```
สิ่งที่ปรากฏบนหน้าจอ คือ
```python
9
```
ซึ่งเป็นจำนวนคำทั้งหมดในลิสต์ของลิสต์ของสตริง

โปรแกรมข้างต้นมีการใช้ for loop ซ้อนกัน (double for loop) โดยที่ for loop ชั้นนอกเป็นการไล่เอาสมาชิกแต่ละตัวที่เป็นลิสต์ออกมาจากลิสต์ของลิสต์ (`sentences`) โดยในแต่ละรอบให้ใช้ตัวแปร `sentence` มาใช้เก็บลิสต์ย่อย และ for loop ชั้นในเป็นการไล่เอาสมาชิกแต่ละตัวที่เป็นสตริงออกมาจากลิสต์ของสตริง (`sentence`) โดยในแต่ละรอบให้ใช้ตัวแปร `word` มาใช้เก็บสตริง และในแต่ละรอบให้นับคำที่อยู่ในตัวแปร `word` แล้วบวกเพิ่มในตัวแปร `total_words` ที่เป็นจำนวนคำทั้งหมด

#### ตัวอย่าง
สมมติว่าเราต้องการหาคำที่สะกดด้วยตัวอักษรภาษาอังกฤษทั้งหมดโดยไม่ต้องนับตัวซ้ำ ข้อมูลที่ได้มาถูกจัดเก็บอยู่ในลิสต์ของลิสต์ของสตริงคำ
```python
list_sen = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
eng_word_set = set()
for sen in list_sen:
    for word in sen:
        if word.isalpha():
            eng_word_set.add(word)
```
 for loop ชั้นนอกเป็นการไล่เอาสมาชิกแต่ละตัวที่เป็นลิสต์ออกมาจากลิสต์ของลิสต์ (`list_sen`) โดยในแต่ละรอบให้ใช้ตัวแปร `sen` มาใช้เก็บลิสต์ย่อย และ for loop ชั้นในเป็นการไล่เอาสมาชิกแต่ละตัวที่เป็นสตริงออกมาจากลิสต์ของสตริง (`sen`) โดยในแต่ละรอบให้ใช้ตัวแปร `word` มาใช้เก็บสตริง และในแต่ละรอบให้ตรวจสอบว่าสตริงที่อยู่ในตัวแปร `word` เป็นสตริงที่มีแต่ตัวอักษรภาษาอังกฤษหรือไม่ โดยใช้ string method `.isalpha()` ซึ่งจะคืนค่าเป็นบูลีน ถ้าเป็นค่า `True` ให้เพิ่มสตริงที่อยู่ในตัวแปร `word` ลงในเซ็ต `eng_word_set` โดยใช้คำสั่ง `eng_word_set.add(word)` ซึ่งเป็นการเพิ่มสตริงลงในเซ็ต และเนื่องจากเราใช้เซ็ตในการเก็บ สตริงที่ซ้ำกันจะถูกลบออกไปโดยอัตโนมัติ

### รันฟังก์ชันไปบนสมาชิกทุกตัวที่อยู่ในลิสต์ย่อย

การรันฟังก์ชันไปบนสมาชิกทุกตัว เราเรียกว่าการทำ function mapping ให้ลองนึกทบทวนถึงการทำ function mapping กับลิสต์ที่ไม่มีการซ้อนลิสต์ จากตัวอย่างต่อไปนี้

สมมติว่า เราต้องการทำ function mapping ด้วยฟังก์ชันยกกำลังสองไปบนลิสต์ของตัวเลข `numbers = [2, 10, 12, 20]`(ซึ่งเป็นลิสต์ที่ยังไม่มีการซ้อนลิสต์) เริ่มจากการสร้างฟังก์ชัน `square` ที่รับตัวเลขเข้ามา แล้วคืนค่ากลับมาเป็นค่าที่ยกกำลังสอง
```python
def square(x):
    return x ** 2
```
เราอยากได้ผลลัพธ์จากการรัน `square` ไปทุกตัวบนลิสต์ `numbers`
```python
results = [square(2), square(10), square(12), square(20)]
``` 
หรือ
```python
results = [square(numbers[0]), square(numbers[1]), square(numbers[2]), square(numbers[3])]
```
แต่เนื่องจากเราไม่รู้ล่วงหน้าว่าลิสต์ `numbers` มีสมาชิกกี่ตัว เราจึงต้องเขียนโค้ดให้สามารถรัน `square` ไปบนสมาชิกทุกตัวของลิสต์ `numbers` ได้โดยไม่ต้องระบุจำนวนรอบของ for loop ไว้ล่วงหน้า เราจึงจำเป็นต้องใช้ function mapping ซึ่งมี 3 วิธี ดังนี้

1. Double for loop:
ใช้ for loop แล้วเก็บผลลัพธ์ไว้ในลิสต์ที่ขึ้นมาเตรียมไว้
    ```python
    results = []
    for ข้อมูลเดี่ยว in ลิสต์:
        ผลลัพธ์ = ฟังก์ชัน(ข้อมูลเดี่ยว)
        results.append(ผลลัพธ์)
    ```
    ตัวอย่าง เช่น
    ```python
    numbers = [2, 10, 12, 20]
    results = []
    for number in numbers:
        results.append(square(number))
    print(results)
    ```
    ผลลัพธ์ที่จะแสดงผลบนหน้าจอ คือ
    ```python
    [4, 100, 144, 400]
    ```
2. List comprehension
    ```python
    results = [ฟังก์ชัน(ข้อมูลเดี่ยว) for ข้อมูลเดี่ยว in ลิสต์]
    ```
    ตัวอย่าง เช่น
    ```python
    numbers = [2, 10, 12, 20]
    results = [square(number) for number in numbers]
    ```
3. `map` แล้วแปลงผลลัพธ์เป็นลิสต์
    ```python
    results = list(map(ฟังก์ชัน, ลิสต์))
    ```
    ตัวอย่าง เช่น
    ```python
    numbers = [2, 10, 12, 20]
    results = list(map(square, numbers))
    ```

เราสามารถใช้วิธีเหล่านี้ในทำนองเดียวกันเพื่อทำ function mapping กับลิสต์ของลิสต์

#### Double for loop 
โครงสร้างของการใช้ for loop เพื่อทำ function mapping จะต้องมีการใช้ for loop ซ้อน for loop ซึ่งมีโครงสร้างดังนี้
```python
results = []
for ลิสต์ย่อย in ลิสต์ใหญ่:
    sub_results = []
    for ข้อมูลเดี่ยว in ลิสต์ย่อย:
        ผลลัพธ์ = ฟังก์ชัน(ข้อมูลเดี่ยว)
        sub_results.append(ผลลัพธ์)
    results.append(sub_results)
```
จุดที่ซับซ้อนและน่าสังเกตคือ การสร้างลิสต์ย่อย `sub_results` ขึ้นมาเพื่อเก็บผลลัพธ์ที่ได้จากการทำ function mapping กับสมาชิกแต่ละตัวในลิสต์ย่อย ถ้าเราแกะเอา for loop ชั้นนอกออกเราก็จะเห็นว่าโครงสร้างนั้นเหมือนกับการทำ function mapping บนลิสต์ที่ไม่มีการซ้อนลิสต์ 
```python
    sub_results = []
    for ข้อมูลเดี่ยว in ลิสต์ย่อย:
        ผลลัพธ์ = ฟังก์ชัน(ข้อมูลเดี่ยว)
        sub_results.append(ผลลัพธ์)
```
แต่เพราะว่าเราต้องการทำ function mapping ไปบนลิสต์ย่อยทุกลิสต์ เราจึงต้องเอาโค้ดก้อนนี้ซ้อนเข้าไปใน for loop ชั้นนอก 1 ชั้น 

*ตัวอย่าง*

สมมติว่าเราต้องการหาความยาวของคำแต่ละคำในประโยคที่เก็บไว้ในลิสต์ของลิสต์ของสตริง เช่น ถ้าหาก input คือ
```python
words = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
```
โปรแกรมจะต้องคืนค่ามาเป็นลิสต์ของลิสต์ของตัวเลข ซึ่งตัวเลขแต่ละตัวคือความยาวของคำในแต่ละตำแหน่ง
```python
[[4, 3, 2, 4], [7, 3, 3, 3, 4, 6]]
```
โจทย์ข้อนี้เราทราบแล้วว่าเราต้องมีการทำ function mapping โดยใช้คำสั่ง `len` ลงบนสมาชิกแต่ละตัวในลิสต์ย่อย ดังนั้นเราสามารถใช้โครงสร้าง double for loop มาประกอบกันได้ดังนี้
```python
words = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
lengths = []
for sen in words:
    sub_lengths = []
    for word in sen:
        sub_lengths.append(len(word))
    lengths.append(sub_lengths)
print(lengths)
```

#### Nested list comprehension
เราสามารถใช้ list comprehension ซ้อนกัน (nested list comprehension) ในการทำ function mapping ได้ดังนี้
```python
results = [[ฟังก์ชัน(ข้อมูลเดี่ยว) for ข้อมูลเดี่ยว in ลิสต์ย่อย] for ลิสต์ย่อย in ลิสต์ใหญ่]
```
สังเกตว่าเราซ้อน expression `[ฟังก์ชัน(ข้อมูลเดี่ยว) for ข้อมูลเดี่ยว in ลิสต์ย่อย]` เข้าไปใน `[expression for ลิสต์ย่อย in ลิสต์ใหญ่]`

*ตัวอย่าง*
```python
words = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
lengths = [[len(word) for word in sen] for sen in words]
print(lengths)
```

### การทำลิสต์ให้เรียบ (flatten) 
การทำลิสต์ให้เรียบ คือ การเปลี่ยนลิสต์ที่เคยเป็นลิสต์ซ้อนลิสต์ให้เป็นลิสต์ธรรมดาที่เก็บข้อมูลเดี่ยวไว้ ในกรณีที่ข้อมูลที่เราได้รับมาเป็นข้อมูลที่มีโครงสร้างที่ซับซ้อนเกินไปอย่างลิสต์ของลิสต์ของคำซึ่งเก็บข้อมูลระดับประโยคไว้ด้วยว่ามีประโยคอยู่กี่ประโยค (ลิสต์ย่อย) และแต่ละประโยคมีคำอยู่กี่คำ (สตริงที่อยู่ในลิสต์ย่อย) หากเราไม่ต้องการข้อมูลในระดับประโยคเราอาจจะย่อลงให้เหลือเพียงลิสต์ของสตริงคำ โดยการทำลิสต์ให้เรียบ

โครงสร้างของโค้ดที่ใช้ในการทำลิสต์ให้เรียบ จะมีการใช้ for loop ซ้อน for loop ซึ่งมีโครงสร้างดังนี้
```python
results = []
for ลิสต์ย่อย in ลิสต์ใหญ่:
    for ข้อมูลเดี่ยว in ลิสต์ย่อย:
        results.append(ข้อมูลเดี่ยว)
```
หรือ จะใช้ list comprehension ซ้อนกัน (nested list comprehension) ในการทำลิสต์ให้เรียบ ดังนี้
```python
results = [ข้อมูลเดี่ยว for ลิสต์ย่อย in ลิสต์ใหญ่ for ข้อมูลเดี่ยว in ลิสต์ย่อย]
```
สังเกตว่าโครงสร้าง nested list comprehension แบบนี้มีลักษณะคล้ายคลึงกับ การทำ function mapping บน nested list ซึ่งมีโครงสร้างดังนี้
```python
results = [[ฟังก์ชัน(ข้อมูลเดี่ยว) for ข้อมูลเดี่ยว in ลิสต์ย่อย] for ลิสต์ย่อย in ลิสต์ใหญ่]
``` 
ข้อแตกต่าง คือ expression ที่ใช้ในการทำลิสต์ให้เรียบมีอยู่ตำแหน่งเดียวเท่านั้น และไม่มีการใช้ฟังก์ชันใด ๆ ในการประมวลผลข้อมูล แต่ว่า nested list comprehension สำหรับ function mapping จะมี expression สำหรับ for loop ชั้นนอกคือ `[ฟังก์ชัน(ข้อมูลเดี่ยว) for ข้อมูลเดี่ยว in ลิสต์ย่อย]` ซึ่งให้ค่าเป็นลิสต์ และ expression สำหรับ for loop ชั้นในคือ `ฟังก์ชัน(ข้อมูลเดี่ยว)` 

ข้อแตกต่างของโครงสร้างอีกอย่างคือ nested list comprehension สำหรับทำให้ลิสต์ให้เรียบ จะมีการใช้ for loop ชั้นนอกก่อน และ for loop ชั้นในทีหลัง แต่สำหรับ function mapping จะมีการใช้ for loop ชั้นในก่อน และ for loop ชั้นนอกหลัง

![illustration of the structures](img/nopic.jpg)

*ตัวอย่าง*
```python
words = [['แซม','ซื้อ','tv','ใหม่'],['android', 'ไม่', 'ได้','ถูก', 'กว่า', 'iphone']]
flattened_word_list = [word for sen in words for word in sen]
print(flattened_word_list)
```
ผลลัพธ์ที่ได้คือ
```python
['แซม', 'ซื้อ', 'tv', 'ใหม่', 'android', 'ไม่', 'ได้', 'ถูก', 'กว่า', 'iphone']
```

## 